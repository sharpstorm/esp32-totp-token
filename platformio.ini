; PlatformIO Project Configuration File
;
;   Build options: build flags, source filter
;   Upload options: custom upload port, speed and extra flags
;   Library options: dependencies, extra library storages
;   Advanced options: extra scripting
;
; Please visit documentation for the other options and examples
; https://docs.platformio.org/page/projectconf.html

[env:m5stick-c]
platform = espressif32
board = m5stick-c
framework = arduino
lib_deps = 
	m5stack/M5StickC@^0.2.5
	bblanchon/ArduinoJson@^7.4.2
board_build.partitions = partitions/partitions.csv
board_build.embed_txtfiles =
  webapp/dist/index.html
  webapp/dist/index.css
  webapp/dist/index.js
  webapp/dist/qr-scanner-worker.min.js
build_flags =
  -DHTTPS_DISABLE_SELFSIGNING
  -DCONFIG_MBEDTLS_KEY_EXCHANGE_ECDHE_ECDSA=1
  -DCONFIG_MBEDTLS_KEY_EXCHANGE_ECDHE_RSA=1
  -DCONFIG_MBEDTLS_ECDH_C=1
  -DCONFIG_MBEDTLS_ECDSA_C=1
  -DCONFIG_MBEDTLS_ECP_C=1
  -DCONFIG_MBEDTLS_ECP_DP_SECP256R1_ENABLED=1
  
  # Enable AES-GCM (hardware accelerated on ESP32-C3)
  -DCONFIG_MBEDTLS_GCM_C=1
  -DCONFIG_MBEDTLS_AES_C=1
  -DCONFIG_MBEDTLS_HARDWARE_AES=1
  
  # Enable SHA hardware acceleration
  -DCONFIG_MBEDTLS_SHA256_C=1
  -DCONFIG_MBEDTLS_HARDWARE_SHA=1
  
  # Enable TLS session tickets for fast reconnection
  -DCONFIG_MBEDTLS_SSL_SESSION_TICKETS=1
  -DCONFIG_ESP_TLS_SERVER_SESSION_TICKETS=1

  # Optimize buffer sizes
  -DCONFIG_MBEDTLS_SSL_IN_CONTENT_LEN=4096
  -DCONFIG_MBEDTLS_SSL_OUT_CONTENT_LEN=4096
  
  # Enable TLS server
  -DCONFIG_ESP_TLS_SERVER=1
  -DCONFIG_MBEDTLS_TLS_SERVER=1
